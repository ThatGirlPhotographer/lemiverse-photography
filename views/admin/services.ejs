<%- include('../partials/admin_header') %>

<style>
    /* --- PAGE LAYOUT --- */
    .manage-container {
        padding: 2rem;
        max-width: 900px;
        margin: 0 auto;
        color: white;
    }

    h2, h3 {
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
        margin-bottom: 30px;
    }

    /* --- SERVICE CARD STYLE --- */
    .service-card {
        background: #121212;
        padding: 20px;
        border: 1px solid #333;
        position: relative;
        margin-bottom: 25px;
        transition: border-color 0.3s;
    }

    .service-card:hover {
        border-color: #555;
    }

    /* --- RESPONSIVE GRID FOR INPUTS --- */
    .input-row {
        display: grid;
        grid-template-columns: 1fr; 
        gap: 15px;
        margin-bottom: 15px;
    }

    @media (min-width: 768px) {
        .input-row {
            grid-template-columns: 2fr 1fr 1fr;
        }
    }

    /* --- INPUT STYLING --- */
    label {
        display: block;
        font-size: 0.75rem;
        color: #888;
        margin-bottom: 5px;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    input[type="text"], 
    textarea {
        width: 100%;
        background: #000;
        border: 1px solid #333;
        color: white;
        padding: 12px;
        font-family: inherit;
        font-size: 0.9rem;
        box-sizing: border-box; 
    }

    input:focus, textarea:focus {
        outline: none;
        border-color: #fff;
    }

    /* --- ACTION BAR --- */
    .action-bar {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        background: #1a1a1a;
        padding: 15px;
        margin-top: 15px;
        gap: 10px;
    }

    /* --- CHECKBOX ALIGNMENT FIX --- */
    .checkbox-wrapper {
        display: flex; 
        align-items: center; /* Vertically center items */
        gap: 10px;
    }

    .checkbox-wrapper input {
        margin: 0; /* Remove default margins */
        transform: scale(1.3); /* Make box slightly bigger */
        cursor: pointer;
    }

    .checkbox-wrapper label {
        margin: 0; /* KILL THE GLOBAL MARGIN-BOTTOM */
        padding: 0;
        color: #ff4444;
        cursor: pointer;
        text-transform: none; 
        font-size: 1rem; 
        font-weight: bold; 
        white-space: nowrap;
        line-height: 1; /* Forces text to sit perfectly in the middle */
    }

    /* --- BUTTONS --- */
    .btn-save {
        background: #00ffcc;
        color: black;
        border: none;
        padding: 10px 25px;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-delete {
        background: transparent;
        color: #666;
        border: none;
        font-size: 0.8rem;
        text-decoration: underline;
        cursor: pointer;
    }
    .btn-delete:hover { color: #ff4444; }

    /* --- ADD NEW SECTION --- */
    .add-new-section {
        background: #1a1a1a;
        padding: 30px;
        border: 1px dashed #555;
        margin-top: 50px;
    }

    /* --- PERFECTLY CENTERED OUTLINE BUTTON --- */
    .btn-add-outline {
        width: 100%;
        box-sizing: border-box; 
        padding: 15px;
        background: transparent;
        border: 1px solid white;
        color: white;
        font-family: inherit;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        text-transform: none; 
    }

    .btn-add-outline:hover {
        background: white;
        color: black;
    }
</style>

<div class="manage-container">
    <h2>Manage Services & Pricing</h2>

    <div>
        <% services.forEach(service => { %>
            <div class="service-card">
                
                <% if(service.is_on_sale) { %>
                    <div style="position: absolute; top: -10px; right: 10px; background: #ff4444; color: white; padding: 4px 10px; font-size: 0.75rem; font-weight: bold;">ON SALE</div>
                <% } %>

                <form action="/admin/services/update" method="POST">
                    <input type="hidden" name="service_id" value="<%= service.service_id %>">
                    
                    <div class="input-row">
                        <div>
                            <label>TITLE</label>
                            <input type="text" name="title" value="<%= service.title %>" style="font-weight: bold;">
                        </div>
                        <div>
                            <label>REGULAR PRICE</label>
                            <input type="text" name="price" value="<%= service.price %>">
                        </div>
                        <div>
                            <label style="color: #ff4444;">SALE PRICE</label>
                            <input type="text" name="sale_price" value="<%= service.sale_price %>" placeholder="£ Sale">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <label>DESCRIPTION</label>
                        <textarea name="description" rows="3"><%= service.description %></textarea>
                    </div>
                    
                    <div class="action-bar">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" name="is_on_sale" id="sale_<%= service.service_id %>" <%= service.is_on_sale ? 'checked' : '' %>>
                            <label for="sale_<%= service.service_id %>">Activate Sale?</label>
                        </div>
                        
                        <button type="submit" class="btn-save">Save Changes</button>
                    </div>
                </form>
                
                <div style="text-align: right; margin-top: 10px;">
                    <form action="/admin/services/delete/<%= service.service_id %>" method="POST" onsubmit="return confirm('Delete this service permanently?');">
                        <button type="submit" class="btn-delete">Delete Service</button>
                    </form>
                </div>
            </div>
        <% }) %>
    </div>

    <div class="add-new-section">
        <h3>+ Add New Package</h3>
        <form action="/admin/services/add" method="POST">
            
            <div class="input-row">
                <div>
                    <label>TITLE</label>
                    <input type="text" name="title" placeholder="e.g. Wedding Package" required>
                </div>
                <div>
                    <label>PRICE</label>
                    <input type="text" name="price" placeholder="e.g. £500" required>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <label>DESCRIPTION</label>
                <textarea name="description" rows="3" placeholder="What's included?" required></textarea>
            </div>

            <button type="submit" class="btn-add-outline">Add Service</button>
        </form>
    </div>

</div>

<%- include('../partials/footer') %>