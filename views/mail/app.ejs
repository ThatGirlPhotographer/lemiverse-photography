<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail Clone</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <script src="/js/mail.js" defer></script> 
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #dadce0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #bdc1c6; }

        .scrolable-width { height: calc(100vh - 122px); }
        .fade-in { animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>

<body class="h-screen flex flex-col md:pb-2 bg-[#f6f9ff] relative overflow-hidden">

    <button onclick="toggleCompose()" class="flex md:hidden gap-4 py-4 px-5 items-center bg-sky-200 ml-2 mt-2 rounded-2xl hover:drop-shadow-md absolute bottom-4 right-4 z-50 text-gray-800">
        <i class="fa-solid fa-pencil text-xl"></i>
        <p class="text-sm font-semibold">Compose</p>
    </button>

    <nav class="w-full py-2 flex px-4 text-gray-600 justify-between items-center shrink-0">
        <div class="flex items-center w-[70%] justify-between gap-3">
            <div class="flex gap-1 items-center">
                <button class="h-10 w-10 grid place-content-center rounded-full hover:bg-gray-200"><i class="fa-solid fa-bars text-lg"></i></button>
                <div>
                    <img class="h-7 ml-2" src="https://ssl.gstatic.com/ui/v1/icons/mail/rfr/logo_gmail_lockup_default_1x_r2.png" alt="Gmail Logo">
                </div>
            </div>

            <div class="hidden group md:flex h-12 items-center rounded-full px-2 bg-[#e5f1ff] gap-2 w-[80%] max-w-2xl hover:shadow-md hover:bg-white transition-all focus-within:bg-white focus-within:shadow-md">
                <button class="grid place-content-center rounded-full hover:bg-gray-200 p-2"><i class="fa-solid fa-magnifying-glass"></i></button>
                <form action="/mail" method="GET" class="w-full h-full">
                    <input name="search" class="h-full w-full focus:outline-none bg-transparent py-2 text-gray-700 placeholder-gray-600" type="text" placeholder="Search mail">
                </form>
                <button class="grid place-content-center rounded-full hover:bg-gray-200 p-2"><i class="fa-solid fa-sliders"></i></button>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <a href="/mail/logout" class="text-sm hover:underline text-red-500 mr-2">Logout</a>
            <button class="grid place-content-center rounded-full hover:bg-gray-200 w-10 h-10 overflow-hidden border border-gray-200 ml-1">
                <img src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" alt="User">
            </button>
        </div>
    </nav>

    <div class="h-full w-full grid grid-cols-10 overflow-hidden">

        <div class="self-start col-span-2 h-full mr-2 hidden md:block overflow-y-auto pb-4">
            <div class="pl-2">
                <button onclick="toggleCompose()" class="flex gap-4 py-4 px-6 items-center bg-[#c2e7ff] text-[#001d35] ml-2 mt-2 rounded-2xl hover:shadow-md transition-shadow cursor-pointer">
                    <i class="fa-solid fa-pencil text-xl"></i>
                    <p class="text-sm font-semibold">Compose</p>
                </button>
            </div>

            <ul class="w-full text-sm my-3">
                <li class="w-full"><a href="/mail?folder=inbox" class="font-semibold w-full flex leading-none <%= currentFilter==='inbox'?'bg-[#d3e3fd] text-[#001d35]':'hover:bg-gray-200' %> pl-6 py-2 gap-3 items-center rounded-e-full pr-2"><i class="fa-solid fa-inbox text-lg"></i><p class="flex w-full justify-between">Inbox <span><%= unreadCount > 0 ? unreadCount : '' %></span></p></a></li>
                <li class="w-full"><a href="/mail?folder=starred" class="w-full flex leading-none <%= currentFilter==='starred'?'bg-[#d3e3fd] text-[#001d35]':'hover:bg-gray-200' %> pl-6 py-2 gap-3 items-center rounded-e-full pr-2"><i class="fa-regular fa-star text-lg"></i><p>Starred</p></a></li>
                <li class="w-full"><a href="/mail?folder=sent" class="w-full flex leading-none <%= currentFilter==='sent'?'bg-[#d3e3fd] text-[#001d35]':'hover:bg-gray-200' %> pl-6 py-2 gap-3 items-center rounded-e-full pr-2"><i class="fa-regular fa-paper-plane text-lg"></i><p>Sent</p></a></li>
                <li class="w-full"><a href="/mail?folder=trash" class="w-full flex leading-none <%= currentFilter==='trash'?'bg-[#d3e3fd] text-[#001d35]':'hover:bg-gray-200' %> pl-6 py-2 gap-3 items-center rounded-e-full pr-2"><i class="fa-regular fa-trash-can text-lg"></i><p>Trash</p></a></li>
            </ul>
        </div>

        <div class="bg-white h-full col-span-10 md:col-span-8 rounded-2xl mx-2 flex flex-col overflow-hidden relative border border-gray-100 shadow-sm">

            <div id="inbox-view" class="flex flex-col h-full w-full absolute inset-0 bg-white z-10 transition-opacity duration-200">
                <div class="bg-white w-full flex py-2 px-4 text-gray-600 text-[0.7rem] justify-between border-b border-gray-100">
                    <div class="flex gap-1">
                        <div class="flex gap-1 items-center hover:bg-gray-100 px-1 rounded cursor-pointer">
                            <input class="w-4 h-4 cursor-pointer" type="checkbox">
                            <i class="fa-solid fa-caret-down"></i>
                        </div>
                        <button onclick="location.reload()" class="grid place-content-center rounded-full hover:bg-gray-200 p-3"><i class="fa-solid fa-rotate-right"></i></button>
                    </div>
                    <div class="flex gap-1 items-center">
                        <div class="flex items-center h-full rounded-md px-2 cursor-pointer hover:bg-gray-200"><p>1-<%= emails.length %> of <%= emails.length %></p></div>
                    </div>
                </div>

                <div id="email-list-container" class="flex-1 overflow-y-auto">
                    <% emails.forEach(email => { %>
                        <div onclick="handleOpenMail('<%= email.id %>')" 
                             class="flex h-10 px-2 items-center text-sm border-b border-gray-100 hover:shadow-md cursor-pointer group hover:z-20 relative <%= email.isRead ? 'bg-gray-50' : 'bg-white font-bold' %>">
                            <div class="flex text-gray-400 h-full items-center font-semibold w-1/5 py-1 pl-2 gap-3">
                                <input type="checkbox" class="w-4 h-4 group-hover:block hidden" onclick="event.stopPropagation()">
                                <i onclick="handleStar(event, '<%= email.id %>')" class="<%= email.isStarred ? 'fa-solid text-yellow-400' : 'fa-regular group-hover:block hidden' %> fa-star hover:text-yellow-400"></i>
                                <span class="text-black ml-1 truncate"><%= email.sender %></span>
                            </div>
                            <div class="flex items-center py-1 px-2 w-[70%] h-full justify-between">
                                <div class="flex w-[98%] overflow-hidden text-ellipsis whitespace-nowrap text-gray-600">
                                    <span class="text-black <%= email.isRead ? '' : 'font-bold' %> mr-1"><%= email.subject %></span> - <%= email.body.substring(0, 50) %>...
                                </div>
                            </div>
                            <div class="flex items-center py-1 px-2 w-[10%] h-full text-black justify-end ml-[10px] text-xs">
                                <%= new Date(email.dateCreated).toLocaleDateString() %>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>

            <div id="read-view" class="hidden flex-col h-full w-full absolute inset-0 bg-white z-20 fade-in" data-current-id="">
                <div class="flex items-center justify-between px-2 md:px-4 py-2 border-b border-gray-100 text-gray-600 text-sm bg-white">
                    <div class="flex items-center gap-2 md:gap-6">
                        <button onclick="closeMailUI()" class="hover:bg-gray-100 p-2 rounded-full text-gray-700"><i class="fa-solid fa-arrow-left text-lg"></i></button>
                        <div class="flex items-center gap-1 md:gap-2">
                            <button onclick="api.trashEmail(document.getElementById('read-view').dataset.currentId).then(()=>window.location.reload())" class="hover:bg-gray-100 p-2 rounded-full"><i class="fa-regular fa-trash-can text-lg"></i></button>
                        </div>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-4 md:px-8 md:py-6">
                    <div class="flex flex-col md:flex-row justify-between items-start mb-6 gap-2">
                        <div class="flex items-start gap-3 w-full">
                            <h1 id="read-subject" class="text-xl md:text-2xl text-gray-900 font-normal leading-tight">Subject</h1>
                            <span class="bg-gray-200 text-gray-600 text-[10px] px-1.5 py-0.5 rounded mt-1 shrink-0">Inbox</span>
                        </div>
                    </div>

                    <div class="flex items-start gap-3 mb-8">
                        <div class="w-10 h-10 bg-[#0b57d0] text-white rounded-full flex items-center justify-center text-xl shrink-0 font-bold">A</div>
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-col md:flex-row justify-between">
                                <div class="flex flex-wrap items-baseline gap-2">
                                    <span id="read-sender" class="font-bold text-gray-900 text-sm">Sender</span>
                                    <span id="read-email" class="text-xs text-gray-500 truncate">&lt;email&gt;</span>
                                </div>
                                <div class="flex items-center gap-2 text-xs text-gray-500 mt-1 md:mt-0">
                                    <span id="read-date">Date</span>
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-0.5">to me <i class="fa-solid fa-caret-down"></i></div>
                        </div>
                    </div>

                    <div id="read-body" class="flex flex-col items-start justify-start py-4 text-gray-800 text-sm whitespace-pre-wrap">
                        </div>

                    <div id="reply-actions" class="flex flex-wrap gap-2 mt-8 mb-20 md:mb-8">
                        <button onclick="showReply()" class="border border-gray-300 rounded-full px-6 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 flex-1 md:flex-none justify-center md:justify-start flex items-center">
                            <i class="fa-solid fa-reply mr-2"></i> Reply
                        </button>
                    </div>

                    <div id="reply-box" class="hidden flex gap-3 mt-4 mb-20 md:mb-8 transition-all">
                        <div class="w-10 h-10 bg-pink-600 rounded-full hidden md:flex items-center justify-center text-white text-lg shrink-0">Me</div>
                        <div class="flex-1 border border-gray-300 rounded-2xl bg-white shadow-sm overflow-hidden flex flex-col">
                            <div class="flex justify-between items-center px-4 py-2 border-b border-gray-100 bg-white">
                                <div class="flex items-center gap-2 text-sm">
                                    <i class="fa-solid fa-reply text-gray-500"></i>
                                    <span class="font-medium text-gray-800 truncate">Replying...</span>
                                </div>
                            </div>
                            <textarea class="w-full p-4 h-32 outline-none text-sm resize-none text-gray-800" placeholder="Type response..."></textarea>
                            <div class="flex justify-between items-center px-2 md:px-4 py-2">
                                <div class="flex items-center gap-2 md:gap-4">
                                    <button class="bg-[#0b57d0] hover:bg-blue-700 text-white px-6 py-2 rounded-full text-sm font-bold shadow-sm transition-colors">Send</button>
                                </div>
                                <button onclick="hideReply()" class="hover:bg-gray-100 p-2 rounded text-gray-500"><i class="fa-regular fa-trash-can"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="compose-modal" class="hidden fixed z-50 bg-white shadow-2xl transition-all duration-200 inset-0 w-full h-full flex flex-col md:inset-auto md:bottom-0 md:right-20 md:w-[500px] md:h-[500px] md:rounded-t-xl md:border md:border-gray-200">
        <form id="compose-form" onsubmit="event.preventDefault(); api.sendEmail();" class="flex flex-col h-full">
            <div class="bg-[#f2f6fc] px-4 py-2 flex justify-between items-center border-b border-gray-100 md:rounded-t-xl cursor-pointer" onclick="toggleCompose()">
                <span class="font-medium text-sm text-gray-800">New Message</span>
                <div class="flex gap-4 text-gray-600">
                    <i class="fa-solid fa-minus hover:bg-gray-200 p-1 rounded hidden md:block"></i>
                    <i class="fa-solid fa-xmark hover:bg-gray-200 p-1 rounded text-lg"></i>
                </div>
            </div>
            <div class="flex flex-col flex-1 relative bg-white">
                <input id="compose-to" type="text" placeholder="Recipients" class="px-4 py-2 border-b border-gray-100 text-sm focus:outline-none placeholder-gray-500">
                <input id="compose-subject" type="text" placeholder="Subject" class="px-4 py-2 border-b border-gray-100 text-sm focus:outline-none placeholder-gray-500">
                <textarea id="compose-body" class="flex-1 p-4 resize-none focus:outline-none text-sm font-normal text-gray-800"></textarea>
            </div>
            
            <div class="px-4 py-3 flex justify-between items-center bg-white">
                <div class="flex items-center gap-4">
                    <button type="submit" class="bg-[#0b57d0] hover:bg-blue-700 text-white px-6 py-2 rounded-full text-sm font-bold shadow-sm transition-colors">Send</button>
                    <div class="flex gap-4 text-gray-500 text-sm items-center">
                        <i class="fa-solid fa-paperclip cursor-pointer hover:text-gray-800" title="Attach"></i>
                    </div>
                </div>
                <button type="button" onclick="toggleCompose()" class="text-gray-500 hover:bg-gray-100 p-2 rounded"><i class="fa-regular fa-trash-can"></i></button>
            </div>
        </form>
    </div>

    <script>
        // Visual Toggles
        function toggleCompose() {
            const modal = document.getElementById('compose-modal');
            modal.classList.toggle('hidden');
        }

        function openMailUI() {
            document.getElementById('inbox-view').classList.add('hidden'); 
            document.getElementById('read-view').classList.remove('hidden');
            document.getElementById('read-view').classList.add('flex');
        }

        function closeMailUI() {
            document.getElementById('inbox-view').classList.remove('hidden');
            document.getElementById('read-view').classList.add('hidden');
            document.getElementById('read-view').classList.remove('flex');
            document.getElementById('reply-actions').classList.remove('hidden');
            document.getElementById('reply-box').classList.add('hidden');
        }

        function showReply() {
            document.getElementById('reply-actions').classList.add('hidden');
            document.getElementById('reply-box').classList.remove('hidden');
        }

        function hideReply() {
            document.getElementById('reply-actions').classList.remove('hidden');
            document.getElementById('reply-box').classList.add('hidden');
        }
    </script>

</body>
</html>